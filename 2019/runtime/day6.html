
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Kubernetes & CRI (II) · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="day7.html" />
    
    
    <link rel="prev" href="day5.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    2019 鐵人賽
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../overview/day1.html">
            
                <a href="../overview/day1.html">
            
                    
                    Kubernetes 設計原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                    Container 介紹
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../container/day2.html">
            
                <a href="../container/day2.html">
            
                    
                    淺談 Container 實現原理- 上
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../container/day3.html">
            
                <a href="../container/day3.html">
            
                    
                    淺談 Container 實現原理- 中
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../container/day4.html">
            
                <a href="../container/day4.html">
            
                    
                    淺談 Container 實現原理- 下
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" >
            
                <span>
            
                    
                    Container Runtime Interface(CRI)
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="day5.html">
            
                <a href="day5.html">
            
                    
                    Kubernetes & CRI (I)
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.3.2" data-path="day6.html">
            
                <a href="day6.html">
            
                    
                    Kubernetes & CRI (II)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="day7.html">
            
                <a href="day7.html">
            
                    
                    Container Runtime - CRI-O
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="day8.html">
            
                <a href="day8.html">
            
                    
                    Container Runtime - Security Container
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="day9.html">
            
                <a href="day9.html">
            
                    
                    Container Runtime - Virtual Machine
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" >
            
                <span>
            
                    
                    Container Network Interface(CNI)
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../network/day10.html">
            
                <a href="../network/day10.html">
            
                    
                    Container Network Interface 介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../network/day11.html">
            
                <a href="../network/day11.html">
            
                    
                    kubernetes 與 CNI 的互動
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../network/day12.html">
            
                <a href="../network/day12.html">
            
                    
                    使用 golang 開發第一個 CNI 程式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../network/day13.html">
            
                <a href="../network/day13.html">
            
                    
                    初探 CNI 的 IP 分配問題 (IPAM)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="../network/day14.html">
            
                <a href="../network/day14.html">
            
                    
                    CNI - Flannel - 安裝設定篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.6" data-path="../network/day15.html">
            
                <a href="../network/day15.html">
            
                    
                    CNI - Flannel - IP 管理篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.7" data-path="../network/day16.html">
            
                <a href="../network/day16.html">
            
                    
                    CNI - Flannel - VXLAN 封包運作篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.8" data-path="../network/day17.html">
            
                <a href="../network/day17.html">
            
                    
                    CNI 閒談
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" >
            
                <span>
            
                    
                    Container Storage Interface(CSI)
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../storage/day18.html">
            
                <a href="../storage/day18.html">
            
                    
                    Container Storage Interface 基本介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../storage/day19.html">
            
                <a href="../storage/day19.html">
            
                    
                    Container Storage Interface 標準介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../storage/day20.html">
            
                <a href="../storage/day20.html">
            
                    
                    Container Storage Interface 與 kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" data-path="../storage/day21.html">
            
                <a href="../storage/day21.html">
            
                    
                    Container Storage Interface(CSI) - NFS 初體驗
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.5" data-path="../storage/day22.html">
            
                <a href="../storage/day22.html">
            
                    
                    CSI 雜談
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" >
            
                <span>
            
                    
                    Device Plugin
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../device-plugin/day23.html">
            
                <a href="../device-plugin/day23.html">
            
                    
                    Device Plugin Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.2" data-path="../device-plugin/day24.html">
            
                <a href="../device-plugin/day24.html">
            
                    
                    Device Plugin - Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.3" data-path="../device-plugin/day25.html">
            
                <a href="../device-plugin/day25.html">
            
                    
                    RDMA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.4" data-path="../device-plugin/day26.html">
            
                <a href="../device-plugin/day26.html">
            
                    
                    SR-IOV
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.7" >
            
                <span>
            
                    
                    Miscellaneous
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.7.1" data-path="../extension/day27.html">
            
                <a href="../extension/day27.html">
            
                    
                    Operator Pattern
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.2" data-path="../extension/day28.html">
            
                <a href="../extension/day28.html">
            
                    
                    Service Catalog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.3" data-path="../security/day29.html">
            
                <a href="../security/day29.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../summary/day30.html">
            
                <a href="../summary/day30.html">
            
                    
                    總結
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <span>
            
                    
                    2020 鐵人賽
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../2020/overview/day1.html">
            
                <a href="../../2020/overview/day1.html">
            
                    
                    DevOps 與 Kubernetes 的愛恨情仇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" >
            
                <span>
            
                    
                    Kubernetes 物件管理與部署
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.2.1" data-path="../../2020/application/day2.html">
            
                <a href="../../2020/application/day2.html">
            
                    
                    Kubernetes 物件管理簡介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.2" data-path="../../2020/application/day3.html">
            
                <a href="../../2020/application/day3.html">
            
                    
                    Helm 的介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2.3" data-path="../../2020/application/day4.html">
            
                <a href="../../2020/application/day4.html">
            
                    
                    Helm 的使用範例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.3" >
            
                <span>
            
                    
                    Kubernetes 本地開發之道
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.3.1" data-path="../../2020/local/day5.html">
            
                <a href="../../2020/local/day5.html">
            
                    
                    淺談本地部署 Kubernetes 的各類選擇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.2" data-path="../../2020/local/day6.html">
            
                <a href="../../2020/local/day6.html">
            
                    
                    K3D與KIND 的部署示範
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.3" data-path="../../2020/local/day7.html">
            
                <a href="../../2020/local/day7.html">
            
                    
                    本地開發 Kubernetes 應用程式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3.4" data-path="../../2020/local/day8.html">
            
                <a href="../../2020/local/day8.html">
            
                    
                    Skaffold  本地開發與測試
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.4" >
            
                <span>
            
                    
                    CI 流水線介紹
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.4.1" data-path="../../2020/ci/day9.html">
            
                <a href="../../2020/ci/day9.html">
            
                    
                    Pipeline System 介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4.2" data-path="../../2020/ci/day10.html">
            
                <a href="../../2020/ci/day10.html">
            
                    
                    CI 與 Kubernetes 的整合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4.3" data-path="../../2020/ci/day11.html">
            
                <a href="../../2020/ci/day11.html">
            
                    
                    Kubernetrs 應用測試
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4.4" data-path="../../2020/ci/day12.html">
            
                <a href="../../2020/ci/day12.html">
            
                    
                    CI Pipeline x Kubernetes 結論
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.5" >
            
                <span>
            
                    
                    CD 流水線介紹
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.5.1" data-path="../../2020/cd/day13.html">
            
                <a href="../../2020/cd/day13.html">
            
                    
                    CD 系統的選擇議題
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5.2" data-path="../../2020/cd/day14.html">
            
                <a href="../../2020/cd/day14.html">
            
                    
                    CD 與 Kubernetes 的整合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5.3" data-path="../../2020/cd/day15.html">
            
                <a href="../../2020/cd/day15.html">
            
                    
                    CD 之 Pull Mode 介紹: Keel
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.6" >
            
                <span>
            
                    
                    GitOps 的部署概念
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.6.1" data-path="../../2020/gitops/day16.html">
            
                <a href="../../2020/gitops/day16.html">
            
                    
                    GitOps 的介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6.2" data-path="../../2020/gitops/day17.html">
            
                <a href="../../2020/gitops/day17.html">
            
                    
                    GitOps 與 Kubernetes 的整合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6.3" data-path="../../2020/gitops/day18.html">
            
                <a href="../../2020/gitops/day18.html">
            
                    
                    GitOps - ArgoCD 介紹
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.7" >
            
                <span>
            
                    
                    Private Registry
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.7.1" data-path="../../2020/registry/day19.html">
            
                <a href="../../2020/registry/day19.html">
            
                    
                    Container Registry 的介紹及需求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7.2" data-path="../../2020/registry/day20.html">
            
                <a href="../../2020/registry/day20.html">
            
                    
                    自架 Registry 的方案介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7.3" data-path="../../2020/registry/day21.html">
            
                <a href="../../2020/registry/day21.html">
            
                    
                    自架 Registry - Harbor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7.4" data-path="../../2020/registry/day22.html">
            
                <a href="../../2020/registry/day22.html">
            
                    
                    自架 Registry 與 Kubernetes 的整合
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.8" >
            
                <span>
            
                    
                    Secret 的議題
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.8.1" data-path="../../2020/secret/day23.html">
            
                <a href="../../2020/secret/day23.html">
            
                    
                    Secret 的部署問題與參考解法(上)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8.2" data-path="../../2020/secret/day24.html">
            
                <a href="../../2020/secret/day24.html">
            
                    
                    Secret 的部署問題與參考解法(下)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8.3" data-path="../../2020/secret/day25.html">
            
                <a href="../../2020/secret/day25.html">
            
                    
                    Secret 使用範例: sealed-secrets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.9" >
            
                <span>
            
                    
                    番外篇
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.9.1" data-path="../../2020/plugin/day26.html">
            
                <a href="../../2020/plugin/day26.html">
            
                    
                    kubectl plugin 介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9.2" data-path="../../2020/plugin/day27.html">
            
                <a href="../../2020/plugin/day27.html">
            
                    
                    Kubernetes plugin 範例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9.3" data-path="../../2020/plugin/day28.html">
            
                <a href="../../2020/plugin/day28.html">
            
                    
                    Kubernetes 第三方好用工具介紹
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.1.10" data-path="../../2020/summary/day29.html">
            
                <a href="../../2020/summary/day29.html">
            
                    
                    Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.11" data-path="../../2020/summary/day30.md">
            
                <span>
            
                    
                    各類資源分享
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <span>
            
                    
                    2021 鐵人賽
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" >
            
                <span>
            
                    
                    Rancher 基本知識
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1.1" data-path="../../2021/day1.html">
            
                <a href="../../2021/day1.html">
            
                    
                    淺談 Kubernetes 的架設與管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.1.2" data-path="../../2021/day2.html">
            
                <a href="../../2021/day2.html">
            
                    
                    何謂 Rancher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.1.3" data-path="../../2021/day3.html">
            
                <a href="../../2021/day3.html">
            
                    
                    Rancher 架構與安裝方式介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.1.4" data-path="../../2021/day4.html">
            
                <a href="../../2021/day4.html">
            
                    
                    透過 RKE 架設第一套 Rancher(上)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.1.5" data-path="../../2021/day5.html">
            
                <a href="../../2021/day5.html">
            
                    
                    透過 RKE 架設第一套 Rancher(下)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.2" >
            
                <span>
            
                    
                    Rancher 系統管理指南
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.2.1" data-path="../../2021/day6.html">
            
                <a href="../../2021/day6.html">
            
                    
                    系統管理指南 - 使用者登入管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2.2" data-path="../../2021/day7.html">
            
                <a href="../../2021/day7.html">
            
                    
                    系統管理指南 - RKE Template
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.3" >
            
                <span>
            
                    
                    Rancher 叢集管理指南
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.3.1" data-path="../../2021/day8.html">
            
                <a href="../../2021/day8.html">
            
                    
                    架設 K8s(上)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3.2" data-path="../../2021/day9.html">
            
                <a href="../../2021/day9.html">
            
                    
                    架設 K8s(下)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3.3" data-path="../../2021/day10.html">
            
                <a href="../../2021/day10.html">
            
                    
                    RKE 管理與操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3.4" data-path="../../2021/day11.html">
            
                <a href="../../2021/day11.html">
            
                    
                    Monitoring 介紹
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.4" >
            
                <span>
            
                    
                    Rancher 專案管理指南
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.4.1" data-path="../../2021/day12.html">
            
                <a href="../../2021/day12.html">
            
                    
                    Project 基本概念介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4.2" data-path="../../2021/day13.html">
            
                <a href="../../2021/day13.html">
            
                    
                    Resource Quota 介紹
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.5" >
            
                <span>
            
                    
                    Rancher 雜談
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.5.1" data-path="../../2021/day14.html">
            
                <a href="../../2021/day14.html">
            
                    
                    其他事項
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5.2" data-path="../../2021/day15.html">
            
                <a href="../../2021/day15.html">
            
                    
                    Rancher & Infrastructure as Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5.3" data-path="../../2021/day16.html">
            
                <a href="../../2021/day16.html">
            
                    
                    Rancher 指令工具的操作
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.6" >
            
                <span>
            
                    
                    Rancher 應用程式部署
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.6.1" data-path="../../2021/day17.html">
            
                <a href="../../2021/day17.html">
            
                    
                    淺談 Rancher 的應用程式管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.6.2" data-path="../../2021/day18.html">
            
                <a href="../../2021/day18.html">
            
                    
                    Rancher Catalog 介紹(v2.0~v2.4)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.6.3" data-path="../../2021/day19.html">
            
                <a href="../../2021/day19.html">
            
                    
                    Rancher App & Marketplace 介紹(v2.5)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.7" >
            
                <span>
            
                    
                    GitOps 部署
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.7.1" data-path="../../2021/day20.html">
            
                <a href="../../2021/day20.html">
            
                    
                    淺談 GitOps 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.2" data-path="../../2021/day21.html">
            
                <a href="../../2021/day21.html">
            
                    
                    GitOps 解決方案比較
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.3" data-path="../../2021/day22.html">
            
                <a href="../../2021/day22.html">
            
                    
                    Rancher Fleet 介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.4" data-path="../../2021/day23.html">
            
                <a href="../../2021/day23.html">
            
                    
                    Fleet 環境架設與介紹
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.5" data-path="../../2021/day24.html">
            
                <a href="../../2021/day24.html">
            
                    
                    Fleet 玩轉第一個 GitOps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.6" data-path="../../2021/day25.html">
            
                <a href="../../2021/day25.html">
            
                    
                    Fleet.yaml 檔案探討
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.7" data-path="../../2021/day26.html">
            
                <a href="../../2021/day26.html">
            
                    
                    Fleet Kubernetes 應用程式部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.8" data-path="../../2021/day27.html">
            
                <a href="../../2021/day27.html">
            
                    
                    Fleet Kustomize 應用程式部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.9" data-path="../../2021/day28.html">
            
                <a href="../../2021/day28.html">
            
                    
                    Fleet Helm 應用程式部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7.10" data-path="../../2021/day29.html">
            
                <a href="../../2021/day29.html">
            
                    
                    Fleet Helm + Kustomize 應用程式部署
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.8" data-path="../../2021/day30.html">
            
                <a href="../../2021/day30.html">
            
                    
                    Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Kubernetes & CRI (II)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="day6-kubernetes--cri-container-runtime-interfaceii">[Day6] Kubernetes &amp; CRI (Container Runtime Interface)(II)</h1>
<blockquote>
<p>&#x672C;&#x6587;&#x540C;&#x6B65;&#x520A;&#x767B;&#x65BC; <a href="https://www.hwchiu.com/kubernetes-cri-ii.html" target="_blank">hwchiu.com - Kubernetes &amp; CRI (II)</a></p>
</blockquote>
<p>2020 IT&#x90A6;&#x5E6B;&#x5FD9;&#x9435;&#x4EBA;&#x8CFD; Kubernetes &#x539F;&#x7406;&#x5206;&#x6790;&#x7CFB;&#x5217;&#x6587;&#x7AE0;</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10215384/" target="_blank">kubernetes &#x63A2;&#x8A0E;</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10216215" target="_blank">Container &amp; Open Container Initiative</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10218127" target="_blank">Container Runtime Interface</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10220626" target="_blank">Container Network Interface</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10224183" target="_blank">Container Storage Interface</a></li>
<li>Device Plugin</li>
<li>Container Security</li>
</ul>
<p>&#x6709;&#x8208;&#x8DA3;&#x7684;&#x8B80;&#x8005;&#x6B61;&#x8FCE;&#x5230;&#x6211;&#x7684;&#x7DB2;&#x7AD9; <a href="https://hwchiu.com" target="_blank">https://hwchiu.com</a> &#x95B1;&#x8B80;&#x5176;&#x4ED6;&#x6280;&#x8853;&#x6587;&#x7AE0;&#xFF0C;&#x6709;&#x4EFB;&#x4F55;&#x932F;&#x8AA4;&#x6216;&#x662F;&#x8A0E;&#x8AD6;&#x6B61;&#x8FCE;&#x76F4;&#x63A5;&#x7559;&#x8A00;&#x6216;&#x5BC4;&#x4FE1;&#x8A0E;&#x8AD6;</p>
<h1 id="&#x524D;&#x8A00;">&#x524D;&#x8A00;</h1>
<p>&#x524D;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x8DDF;&#x5927;&#x5BB6;&#x63A2;&#x8A0E;&#x4E86; <code>kubernetes</code> &#x5167;&#x95DC;&#x65BC;&#x5BB9;&#x5668;&#x904B;&#x884C;&#x6A19;&#x6E96;&#x5316;&#x7684;&#x67B6;&#x69CB;&#xFF0C;&#x900F;&#x904E; <code>Container Runtime Interface</code> &#x8207;&#x5404;&#x5F0F;&#x5404;&#x6A23;&#x7684; <code>Container Runtime</code> &#x89E3;&#x6C7A;&#x65B9;&#x6848;&#x6E9D;&#x901A;&#xFF0C;&#x53EF;&#x4EE5;&#x8B93; <code>kubernetes</code> &#x672C;&#x8EAB;&#x53EA;&#x9700;&#x8981;&#x5C08;&#x6CE8;&#x65BC; <code>kubelet</code> &#x4EE5;&#x53CA; <code>CRI &#x6A19;&#x6E96;</code> &#x7684;&#x4E92;&#x52D5;&#xFF0C;&#x7B2C;&#x4E09;&#x65B9;&#x958B;&#x767C;&#x8005;&#x5247;&#x53EF;&#x4EE5;&#x6839;&#x64DA;&#x9700;&#x6C42;&#x958B;&#x767C;&#x51FA;&#x5404;&#x5F0F;&#x5404;&#x6A23;&#x4E0D;&#x540C;&#x7684;&#x7522;&#x54C1;&#xFF0C;&#x53EA;&#x8981;&#x80FD;&#x5920;&#x6EFF;&#x8DB3; <code>CRI &#x6A19;&#x6E96;</code> &#x5373;&#x53EF;&#x3002;</p>
<p>&#x5C31;&#x6211;&#x6240;&#x77E5;&#xFF0C;&#x76EE;&#x524D;&#x76F8;&#x5BB9;&#x65BC; <code>CRI</code> &#x7684;&#x89E3;&#x6C7A;&#x65B9;&#x6848;&#x53EF;&#x6839;&#x64DA;&#x5176;&#x67B6;&#x69CB;&#x5206;&#x6210;&#x4E09;&#x5927;&#x985E;&#xFF0C;&#x5206;&#x5225;&#x662F;</p>
<ul>
<li>&#x771F;&#x7684;&#x662F;&#x8F15;&#x91CF;&#x7D1A;&#x865B;&#x64EC;&#x5316;&#x7684;&#x5BB9;&#x5668;</li>
<li>&#x80CC;&#x5F8C;&#x662F;&#x865B;&#x64EC;&#x6A5F;&#x5668;&#xFF0C;&#x4F46;&#x662F;&#x537B;&#x904B;&#x4F5C;&#x8D77;&#x4F86;&#x50CF;&#x8F15;&#x91CF;&#x7D1A;&#x865B;&#x64EC;&#x5316;&#x7684;&#x5BB9;&#x5668;</li>
<li>&#x771F;&#x7684;&#x662F;&#x50B3;&#x7D71;&#x865B;&#x64EC;&#x6A5F;&#x5668;</li>
</ul>
<p>&#x63A5;&#x4E0B;&#x4F86;&#x7684;&#x6578;&#x7BC7;&#x6587;&#x7AE0;&#x6703;&#x6839;&#x64DA;&#x6BCF;&#x500B;&#x985E;&#x5225;&#x8A73;&#x7D30;&#x4ECB;&#x7D39;&#x4E00;&#x7A2E;&#x89E3;&#x6C7A;&#x65B9;&#x6848;&#xFF0C;&#x4E26;&#x63A2;&#x8A0E;&#x8A2D;&#x8A08;&#x7406;&#x5FF5;&#x8207;&#x67B6;&#x69CB;&#xFF0C;&#x8207;&#x6B64;&#x540C;&#x6642;&#x5927;&#x5BB6;&#x4E5F;&#x53EF;&#x4EE5;&#x601D;&#x8003;&#x81EA;&#x5DF1;&#x7684;&#x74B0;&#x5883;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x53EF;&#x80FD;&#x53EF;&#x4EE5;&#x642D;&#x8F09;&#x5176;&#x4ED6;&#x7684;&#x89E3;&#x6C7A;&#x65B9;&#x6848;&#xFF0C;&#x800C;&#x975E;&#x6C38;&#x9060;&#x4F7F;&#x7528; <code>Docker</code> ?</p>
<p>&#x672C;&#x7BC7;&#x6703;&#x5148;&#x900F;&#x904E;&#x4E00;&#x500B;&#x7C21;&#x55AE;&#x7684;&#x74B0;&#x5883;&#x5BE6;&#x9A57;&#x4F86;&#x5E36;&#x904E;&#x5982;&#x4F55;&#x5EFA;&#x7F6E;&#x4E00;&#x500B;&#x4F7F;&#x7528; <code>containerd</code> &#x7684; <code>kubernetes</code> &#x74B0;&#x5883;&#xFF0C;&#x53EF;&#x4EE5;&#x9AD4;&#x9A57;&#x5230;&#x4E0D;&#x5B89;&#x88DD; <code>docker</code> &#x4E5F;&#x53EF;&#x4EE5;&#x904B;&#x884C;&#x7684; <code>kubernetes</code> &#x53E2;&#x96C6;&#xFF0C; &#x540C;&#x6642;&#x4E4B;&#x5F8C;&#x82E5;&#x5B89;&#x88DD;&#x4E86; <code>docker</code> &#x4E5F;&#x53EF;&#x4EE5;&#x89C0;&#x5BDF;&#x5230;&#x662F;&#x5426;&#x771F;&#x7684;&#x5982;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x6240;&#x8AAA;&#xFF0C; <code>docker</code> &#x8207; <code>kubernetes</code> &#x672C;&#x8EAB;&#x5275;&#x9020;&#x51FA;&#x4F86;&#x7684; <code>container</code> &#x662F;&#x4E92;&#x76F8;&#x4E0D;&#x5E72;&#x6D89;&#x7684;&#x3002;</p>
<h1 id="&#x74B0;&#x5883;&#x5EFA;&#x7F6E;">&#x74B0;&#x5883;&#x5EFA;&#x7F6E;</h1>
<p>&#x63A5;&#x4E0B;&#x4F86;&#x7684;&#x5EFA;&#x7F6E;&#x74B0;&#x5883;&#x8207;&#x6B65;&#x9A5F;&#x662F;&#x53C3;&#x8003; <a href="https://github.com/containerd/cri/tree/master/contrib/ansible" target="_blank">Containerd GitHub</a> &#x6FC3;&#x7E2E;&#x7684;&#x3002;</p>
<h2 id="&#x74B0;&#x5883;&#x9700;&#x6C42;">&#x74B0;&#x5883;&#x9700;&#x6C42;</h2>
<ul>
<li>OS: Ubuntu 16.04<ul>
<li>18.04 &#x6703;&#x56E0;&#x70BA; <code>kubernetes deb</code> &#x76F8;&#x95DC;&#x7684;&#x554F;&#x984C;&#x5C0E;&#x81F4;&#x5957;&#x4EF6;&#x66F4;&#x65B0;&#x5931;&#x6557;&#xFF0C;&#x5EFA;&#x8B70;&#x5148;&#x57FA;&#x65BC; <code>16.04</code> &#x6E2C;&#x8A66;&#x5373;&#x53EF;</li>
</ul>
</li>
<li>Python: 2.7+</li>
<li>Ansible: 2.4+<ul>
<li>&#x6709;&#x6C92;&#x6709;&#x4F7F;&#x7528; <code>ansible</code> &#x90FD;&#x7121;&#x6240;&#x8B02;&#xFF0C;&#x56E0;&#x70BA;&#x6211;&#x5011;&#x6703;&#x62C6;&#x89E3;&#x88E1;&#x9762;&#x7684;&#x6B65;&#x9A5F;&#xFF0C;&#x53BB;&#x770B;&#x770B;&#x5168;&#x90E8;&#x7684;&#x5B89;&#x88DD;&#x6B65;&#x9A5F;</li>
<li></li>
</ul>
</li>
</ul>
<h2 id="&#x74B0;&#x5883;&#x5B89;&#x88DD;">&#x74B0;&#x5883;&#x5B89;&#x88DD;</h2>
<p>&#x74B0;&#x5883;&#x7684;&#x90E8;&#x5206;&#x53EA;&#x6709;&#x5305;&#x62EC; <code>containerd</code> &#x7684;&#x76F8;&#x4F9D;&#x5957;&#x4EF6;&#xFF0C;&#x4E26;&#x4E0D;&#x5305;&#x542B; <code>kubernetes</code> &#x53E2;&#x96C6;&#x672C;&#x8EAB;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x5305;&#x542B; <code>kubeadm</code>, <code>kubectl</code>, <code>kubelet</code> &#x76F8;&#x95DC;&#x5957;&#x4EF6;&#x3002;</p>
<h3 id="ansible-&#x7248;&#x672C;">Ansible &#x7248;&#x672C;</h3>
<p>&#x57FA;&#x672C;&#x4E0A;&#x5B98;&#x65B9;&#x6587;&#x4EF6;&#x5DF2;&#x7D93;&#x5C07;&#x76F8;&#x95DC;&#x7684;&#x6B65;&#x9A5F;&#x90FD;&#x5EFA;&#x7F6E;&#x5B8C;&#x7562;&#xFF0C;&#x672C;&#x8EAB;&#x53EA;&#x9700;&#x8981;&#x6E96;&#x5099; <code>hosts</code> &#x7684;&#x6A94;&#x6848;&#x5373;&#x53EF;&#xFF0C;&#x8A72; <code>ansible playbook</code> &#x652F;&#x63F4; <code>Ubuntu</code> &#x4EE5;&#x53CA; <code>CentOS</code> &#x5169;&#x5957;&#x767C;&#x884C;&#x7248;&#x672C;&#x3002;</p>
<p>&#x9996;&#x5148;&#x5728; <code>ansible host</code> &#x57F7;&#x884C;&#x4E0B;&#x5217;&#x6307;&#x4EE4;&#x6293;&#x53D6;&#x76F8;&#x95DC;&#x7684; <code>ansible-playbook</code></p>
<pre><code class="lang-bash=">git clone https://github.com/containerd/cri
cd ./cri/contrib/ansible
</code></pre>
<p>&#x63A5;&#x4E0B;&#x4F86;&#x6839;&#x64DA;&#x9700;&#x6C42;&#x7522;&#x751F;&#x5C0D;&#x61C9;&#x7684; <code>hosts</code> &#x6A94;&#x6848;&#xFF0C;&#x88E1;&#x9762;&#x653E;&#x7F6E;&#x8981;&#x88AB;&#x5B89;&#x88DD;&#x7684;&#x6A5F;&#x5668;&#xFF0C;&#x6216;&#x662F;&#x76F4;&#x63A5;&#x63A1;&#x7528; <code>localhost</code> &#x7684;&#x65B9;&#x5F0F;&#x518D;&#x672C;&#x6A5F;&#x904B;&#x884C;&#x8A72; <code>playbook</code> &#x5373;&#x53EF;&#x3002;
&#x9019;&#x90E8;&#x5206;&#x6BD4;&#x8F03;&#x5C6C;&#x65BC; <code>ansible</code> &#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E0D;&#x719F;&#x6089;&#x7684;&#x8B80;&#x8005;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x5C0B;&#x627E;&#x8CC7;&#x6E90;&#x770B;&#x770B;&#x5982;&#x4F55;&#x904B;&#x884C;&#xFF0C;&#x6216;&#x662F;&#x653E;&#x68C4;&#x63A1;&#x7528; <code>ansible</code>, &#x800C;&#x662F;&#x9010;&#x689D;&#x9010;&#x689D;&#x7684;&#x81EA;&#x884C;&#x5B89;&#x88DD;</p>
<pre><code class="lang-bash=">ansible-playbook -i hosts cri-containerd.yaml
</code></pre>
<p>&#x9806;&#x5229;&#x8DD1;&#x5B8C;&#x61C9;&#x8A72;&#x6703;&#x770B;&#x5230;&#x985E;&#x4F3C;&#x4E0B;&#x5716;&#x7684;&#x7D50;&#x679C;</p>
<pre><code class="lang-bash=">...
TASK [Create a directory for cni binary] ***********************************************************************************************************************************$
changed: [localhost]

TASK [Create a directory for cni config files] *****************************************************************************************************************************$
changed: [localhost]

TASK [Create a directory for containerd config] ****************************************************************************************************************************$
changed: [localhost]

TASK [Start Containerd] ****************************************************************************************************************************************************$changed: [localhost]

TASK [Load br_netfilter kernel module] *************************************************************************************************************************************$
changed: [localhost]

TASK [Set bridge-nf-call-iptables] *****************************************************************************************************************************************$
changed: [localhost]

TASK [Set ip_forward] ******************************************************************************************************************************************************$
changed: [localhost]

TASK [Check kubelet args in kubelet config] ********************************************************************************************************************************$
changed: [localhost]

TASK [Add runtime args in kubelet conf] ************************************************************************************************************************************$
skipping: [localhost]

TASK [Start Kubelet] *******************************************************************************************************************************************************$
changed: [localhost]

TASK [Pre-pull pause container image] **************************************************************************************************************************************$
changed: [localhost]

PLAY RECAP ******************************************************************************************************************************************************************
...
</code></pre>
<h3 id="&#x624B;&#x52D5;&#x5B89;&#x88DD;&#x7248;&#x672C;">&#x624B;&#x52D5;&#x5B89;&#x88DD;&#x7248;&#x672C;</h3>
<p>&#x5982;&#x679C;&#x4E0D;&#x60F3;&#x900F;&#x904E; <code>ansible</code> &#x4E00;&#x9375;&#x5B89;&#x88DD;&#x5B8C;&#x7562;&#xFF0C;&#x63A5;&#x4E0B;&#x4F86;&#x900F;&#x904E;&#x62C6;&#x89E3;&#x8A72; <code>ansible playbook</code> &#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x5BE6;&#x969B;&#x4E0A;&#x8981;&#x505A;&#x54EA;&#x4E9B;&#x6B65;&#x9A5F;&#x4F86;&#x5EFA;&#x7F6E; <code>containerd</code> &#x7684;&#x74B0;&#x5883;&#x3002;</p>
<ol>
<li>&#x8B80;&#x53D6;&#x4E0B;&#x5217;&#x8B8A;&#x6578; <code>var/vars.yaml</code><ul>
<li>containerd_release_version: 1.1.0-rc.0</li>
<li>cni_bin_dir: /opt/cni/bin/</li>
<li>cni_conf_dir: /etc/cni/net.d/
&#x7B2C;&#x4E00;&#x500B;&#x6307;&#x660E; <code>containerd</code> &#x7684;&#x7248;&#x672C;&#x5F8C;&#xFF0C;&#x5F8C;&#x7E8C;&#x5169;&#x500B;&#x8B8A;&#x6578;&#x5247;&#x662F; <code>CNI (Container Network Interface)</code> &#x6703;&#x7528;&#x5230;&#x7684;&#x8DEF;&#x5F91;&#xFF0C;&#x4E4B;&#x5F8C;&#x7684;&#x6587;&#x7AE0;&#x6703;&#x7D30;&#x90E8;&#x63A2;&#x8A0E; <code>CNI</code> &#x7684;&#x8A2D;&#x8A08;&#x8207;&#x4F7F;&#x7528;&#x3002;</li>
</ul>
</li>
<li>&#x6839;&#x64DA;&#x767C;&#x884C;&#x7248;&#x672C;&#x8B80;&#x53D6;&#x4E0D;&#x540C;&#x7684;&#x6A94;&#x6848;&#x4F86;&#x5B89;&#x88DD;&#x76F8;&#x95DC;&#x5957;&#x4EF6; (Ubuntu &#x70BA;&#x7BC4;&#x4F8B;)<ul>
<li>unzip</li>
<li>tar</li>
<li>apt-transport-https</li>
<li>btrfs-tools</li>
<li>libseccomp2</li>
<li>socat</li>
<li>util-linux</li>
</ul>
</li>
<li>&#x5B89;&#x88DD; <code>kubernetes</code> &#x6703;&#x7528;&#x5230;&#x7684;&#x76F8;&#x95DC;&#x5DE5;&#x5177;<ul>
<li>kubelet</li>
<li>kubeadm</li>
<li>kubectl</li>
</ul>
</li>
<li>&#x5B89;&#x88DD; <code>containerd</code> &#x6703;&#x7528;&#x5230;&#x7684;&#x76F8;&#x95DC;&#x5DE5;&#x5177;<ul>
<li>cri-containerd</li>
<li>&#x4F86;&#x6E90;&#x7DB2;&#x5740;&#x662F; <a href="https://storage.googleapis.com/cri-containerd-release" target="_blank">https://storage.googleapis.com/cri-containerd-release</a>, &#x9EDE;&#x9032;&#x53BB;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5404;&#x7A2E;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684; <code>cri-containerd</code>.</li>
<li>&#x89E3;&#x58D3;&#x7E2E;&#x8A72;&#x5B89;&#x88DD;&#x6A94;&#x6848;&#x5F8C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6709;&#x4E0B;&#x5217;&#x5167;&#x5BB9;&#xFF0C;&#x5305;&#x542B;&#x4E86; <code>systemd</code> &#x7684;&#x8A2D;&#x5B9A;&#xFF0C;&#x76F8;&#x95DC;&#x7684;&#x57F7;&#x884C;&#x6A94;&#x6848;&#x3002;<pre><code class="lang-bash=">./
./opt/
./opt/containerd/
./opt/containerd/cluster/
./opt/containerd/cluster/gce/
./opt/containerd/cluster/gce/cloud-init/
./opt/containerd/cluster/gce/cloud-init/node.yaml
./opt/containerd/cluster/gce/cloud-init/master.yaml
./opt/containerd/cluster/gce/configure.sh
./opt/containerd/cluster/gce/env
./opt/containerd/cluster/version
./opt/containerd/cluster/health-monitor.sh
./usr/
./usr/local/
./usr/local/sbin/
./usr/local/sbin/runc
./usr/local/bin/
./usr/local/bin/crictl
./usr/local/bin/containerd
./usr/local/bin/containerd-stress
./usr/local/bin/critest
./usr/local/bin/containerd-release
./usr/local/bin/containerd-shim
./usr/local/bin/ctr
./etc/
./etc/systemd/
./etc/systemd/system/
./etc/systemd/system/containerd.service
./etc/crictl.yaml
</code></pre>
</li>
</ul>
</li>
<li>&#x900F;&#x904E; <code>systemd</code> &#x555F;&#x52D5; <code>containerd</code></li>
<li>&#x8A2D;&#x5B9A; <code>netfilter</code> &#x76F8;&#x95DC;&#x8A2D;&#x5B9A;&#xFF0C;&#x8B93; <code>kernel</code> &#x555F;&#x52D5;&#x76F8;&#x95DC;&#x529F;&#x80FD;<ul>
<li>br_netfilter -&gt; bridge &#x5C64;&#x7D1A;&#x555F;&#x52D5; netfilter (ebtables)</li>
<li>bridge-nf-call-iptables -&gt; bridge &#x5C64;&#x7D1A;&#x4E5F;&#x6703;&#x53BB;&#x547C;&#x53EB; iptables &#x8655;&#x7406;</li>
<li>ip_forward -&gt; &#x8F49;&#x767C; ip &#x5C01;&#x5305;
&#x9019;&#x4E9B;&#x529F;&#x80FD;&#x57FA;&#x672C;&#x4E0A;&#x4EE5;&#x524D;&#x5B89;&#x88DD; <code>docker</code> &#x7684;&#x6642;&#x5019;&#x90FD;&#x6703;&#x5E6B;&#x5FD9;&#x8655;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x4E0D;&#x6703;&#x7279;&#x5225;&#x6CE8;&#x610F;&#x5230;</li>
</ul>
</li>
<li>&#x63A5;&#x4E0B;&#x4F86;&#x5C31;&#x662F;&#x91CD;&#x982D;&#x6232;&#x4E86;&#xFF0C;&#x5982;&#x4F55;&#x8B93; <code>kubernetes</code> &#x77E5;&#x9053;&#x8981;&#x4F7F;&#x7528; <code>containerd</code> &#x4F5C;&#x70BA;&#x5176; <code>Container Runtime</code> &#x800C;&#x975E;&#x4F7F;&#x7528; <code>dockershim</code> &#x4F86;&#x929C;&#x63A5; <code>docker</code>.
&#x6839;&#x64DA; <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/" target="_blank">&#x5B98;&#x65B9;&#x6587;&#x4EF6;</a>&#xFF0C; <code>kubelet</code> &#x88E1;&#x9762;&#x6709;&#x4E0B;&#x5217;&#x7684;&#x53C3;&#x6578;&#x53EF;&#x4EE5;&#x8A2D;&#x5B9A;<blockquote>
<p>--container-runtime string
The container runtime to use. Possible values: &apos;docker&apos;, &apos;remote&apos;, &apos;rkt(deprecated)&apos;. (default &quot;docker&quot;)
--container-runtime-endpoint string
[Experimental] The endpoint of remote runtime service. Currently unix socket is supported on Linux, and tcp is supported on windows.</p>
</blockquote>
</li>
</ol>
<p>&#x5176;&#x4E2D; <code>container-runtime</code> &#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E09;&#x7A2E;&#x4F86;&#x8655;&#x7406;&#xFF0C;&#x5206;&#x5225;&#x662F;&#x5167;&#x5EFA;&#x7684; <code>docker</code>, <code>rkt</code> &#x4EE5;&#x53CA;&#x5BA2;&#x88FD;&#x5316;&#x7684; <code>remote</code>.
&#x7576;&#x4E0A;&#x8FF0;&#x9078;&#x64C7;&#x4E86; <code>remote</code> &#x5F8C;&#xFF0C;&#x4E5F;&#x5FC5;&#x9808;&#x8981;&#x4E00;&#x8D77;&#x8A2D;&#x5B9A; <code>container-runtime-endpoint</code> &#x544A;&#x8A34; <code>kubelet</code> &#x9019;&#x6642;&#x5019;&#x8981;&#x600E;&#x9EBC;&#x8DDF;&#x975E;&#x5167;&#x5EFA;&#x7684; <code>container runtime</code> &#x6E9D;&#x901A;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#x5B89;&#x88DD;&#x904E;&#x7A0B;&#x4E2D;&#xFF0C;&#x8A72; <code>ansible playbook</code> &#x5C31;&#x6703;&#x5617;&#x8A66;&#x4FEE;&#x6539; <code>kubelet</code> &#x7684;&#x555F;&#x52D5;&#x53C3;&#x6578;&#xFF0C;&#x9019;&#x90E8;&#x5206;&#x56E0;&#x70BA;&#x6574;&#x500B;&#x5B89;&#x88DD;&#x904E;&#x7A0B;&#x90FD;&#x662F;&#x900F;&#x904E; <code>kubeadm</code> &#x53BB;&#x67B6;&#x8A2D; <code>kubernetes cluster</code>, &#x6240;&#x4EE5;&#x6700;&#x5F8C;&#x662F;&#x4FEE;&#x6539; <code>/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code> &#x9019;&#x500B;&#x6A94;&#x6848;. &#x95DC;&#x65BC; <code>kubeadm</code> &#x8207; <code>kubelet</code> &#x5F7C;&#x6B64;&#x4E4B;&#x9593;&#x7684;&#x8A2D;&#x5B9A;&#x904E;&#x7A0B;&#x53EF;&#x4EE5;&#x53C3;&#x8003;&#x4E0B;&#x5217;&#x6587;&#x7AE0; <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/kubelet-integration/#the-kubelet-drop-in-file-for-systemd" target="_blank">kubeadm/kubelet-integration</a></p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~$ sudo cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
# Note: This dropin only works with kubeadm and kubelet v1.11+
[Service]
Environment=&quot;KUBELET_EXTRA_ARGS= --runtime-cgroups=/system.slice/containerd.service --container-runtime=remote --runtime-request-timeout=15m --container-runtime-endpoint=unix:///run/containerd/containerd.sock&quot;
Environment=&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;
Environment=&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&quot;
# This is a file that &quot;kubeadm init&quot; and &quot;kubeadm join&quot; generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically
EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env
# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use
# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.
EnvironmentFile=-/etc/default/kubelet
ExecStart=
ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS
</code></pre>
<p>&#x7576;&#x6211;&#x5011;&#x5BE6;&#x969B;&#x89C0;&#x5BDF;&#x9019;&#x500B;&#x6A94;&#x6848;&#xFF0C;&#x53EF;&#x4EE5;&#x767C;&#x73FE;&#x88E1;&#x9762;&#x95DC;&#x65BC;&#x74B0;&#x5883;&#x8B8A;&#x6578;&#x7684;&#x90E8;&#x5206;&#x52A0;&#x5165;&#x4E86;&#x4E0B;&#x5217;&#x9078;&#x9805;&#xFF0C;&#x9019;&#x6642;&#x5019;&#x6211;&#x5011;&#x5C31;&#x660E;&#x77AD;&#x5230;&#x5E95; <code>kubernetes</code> &#x4E4B;&#x5F8C;&#x662F;&#x5982;&#x4F55;&#x8DDF; <code>containerd</code> &#x6E9D;&#x901A;&#x7684;
<code>--container-runtime=remote --runtime-request-timeout=15m --container-runtime-endpoint=unix:///run/containerd/containerd.sock&quot;</code></p>
<ol>
<li>&#x6700;&#x5F8C;&#x5C31;&#x662F;&#x555F;&#x52D5; <code>kubelet</code> &#x5C07;&#x57FA;&#x672C;&#x7684;&#x670D;&#x52D9;&#x8D77;&#x4F86;<h2 id="kubernetes-cluster">Kubernetes Cluster</h2>
&#x4E00;&#x5207;&#x90FD;&#x6E96;&#x5099;&#x5C31;&#x7DD2;&#x5F8C;&#xFF0C;&#x63A5;&#x4E0B;&#x4F86;&#x975E;&#x5E38;&#x7C21;&#x55AE;&#x7684;&#x900F;&#x904E; <code>kubeadm</code> &#x7684;&#x65B9;&#x5F0F;&#x4F86;&#x5275;&#x5EFA; <code>kubernetes cluster</code>.
&#x9019;&#x500B;&#x7BC4;&#x4F8B;&#x4E2D;&#x6211;&#x63A1;&#x7528; <code>flannel</code> &#x4F5C;&#x70BA; CNI, &#x4E4B;&#x5F8C;&#x4E5F;&#x6703;&#x6709;&#x6587;&#x7AE0;&#x8A73;&#x7D30;&#x4ECB;&#x7D39; <code>Flannel</code> &#x7684;&#x904B;&#x4F5C;&#x539F;&#x7406;&#x3002;</li>
</ol>
<p>&#x4F9D;&#x5E8F;&#x57F7;&#x884C;&#x4E0B;&#x5217;&#x6307;&#x4EE4;&#x5C07; <code>kubernetes cluster</code> &#x7D66;&#x5EFA;&#x7ACB;&#x8D77;&#x4F86;&#xFF0C;&#x4E26;&#x5B89;&#x88DD; <code>CNI</code> &#x540C;&#x6642;&#x4E5F;&#x6253;&#x958B;
<code>taint</code> &#x8B93; <code>master node</code> &#x4E5F;&#x53EF;&#x4EE5;&#x90E8;&#x7F72; <code>Pod</code>.</p>
<pre><code class="lang-bash=">sudo swapoff -a &amp;&amp; sudo sysctl -w vm.swappiness=0
sudo kubeadm init --pod-network-cidr=10.244.0.0/16
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml
kubectl taint nodes --all node-role.kubernetes.io/master-
</code></pre>
<p>&#x9019;&#x6642;&#x5019;&#x4F7F;&#x7528;&#x7C21;&#x55AE;&#x7684;&#x5DE5;&#x5177;&#x78BA;&#x8A8D; <code>kubernetes</code> &#x6709;&#x6B63;&#x5E38;&#x8D77;&#x4F86;&#x5373;&#x53EF;</p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~/cri/contrib/ansible$ kubectl get pods --all-namespaces
NAMESPACE     NAME                          READY   STATUS    RESTARTS   AGE
kube-system   coredns-5c98db65d4-ghzpl      0/1     Running   0          26s
kube-system   coredns-5c98db65d4-thsdq      0/1     Running   0          26s
kube-system   kube-flannel-ds-amd64-ztqgs   1/1     Running   0          14s
kube-system   kube-proxy-jfs66              1/1     Running   0          26s
</code></pre>
<h1 id="&#x89C0;&#x5BDF;">&#x89C0;&#x5BDF;</h1>
<h2 id="containerd">Containerd</h2>
<p>&#x63A5;&#x4E0B;&#x4F86;&#x6211;&#x5011;&#x8981;&#x900F;&#x904E;&#x4E0D;&#x540C;&#x7684;&#x5DE5;&#x5177;&#x4F86;&#x89C0;&#x5BDF;&#x7576;&#x4F7F;&#x7528; <code>containerd</code> &#x4F5C;&#x70BA;&#x90E8;&#x7F72;&#x6642;&#x6709;&#x4EC0;&#x9EBC;&#x4E0D;&#x540C;</p>
<p>&#x7531;&#x65BC;&#x6B64;&#x6642;&#x6211;&#x5011;&#x4E0D;&#x662F;&#x900F;&#x904E; <code>docker</code> &#x4F86;&#x7BA1;&#x7406;&#x6574;&#x500B; <code>kubernetes</code> &#x5E95;&#x5C64;&#x9700;&#x8981;&#x7684; <code>container</code>&#xFF0C;&#x800C;&#x662F;&#x900F;&#x904E; <code>kubelet &amp; CRI &amp; containerd</code> &#x4F86;&#x7BA1;&#x7406;&#x3002;
&#x6240;&#x4EE5;&#x9019;&#x6642;&#x5019;&#x5C31;&#x4E0D;&#x80FD;&#x900F;&#x904E; <code>docker ps</code> &#x6216;&#x662F; <code>docker images</code> &#x7B49;&#x6307;&#x4EE4;&#x4F86;&#x770B;&#x76F8;&#x95DC;&#x7684; <code>container</code> &#x8CC7;&#x6E90;&#xFF0C;&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x7684;&#x662F; <code>crictl</code> &#x9019;&#x500B;&#x5728;&#x524D;&#x9762;&#x6B65;&#x9A5F;&#x4F34;&#x96A8; <code>containerd</code> &#x4E00;&#x8D77;&#x5B89;&#x88DD;&#x5230;&#x7CFB;&#x7D71;&#x5167;&#x7684;&#x5DE5;&#x5177;&#x3002;</p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~/cri/contrib/ansible$ crictl
NAME:
   crictl - client for CRI

USAGE:
   crictl [global options] command [command options] [arguments...]

VERSION:
   1.0.0-beta.0

COMMANDS:
     attach        Attach to a running container
     create        Create a new container
     exec          Run a command in a running container
     version       Display runtime version information
     images        List images
     inspect       Display the status of one or more containers
     inspecti      Return the status of one ore more images
     inspectp      Display the status of one or more pod sandboxes
     logs          Fetch the logs of a container
     port-forward  Forward local port to a pod sandbox
     ps            List containers
     pull          Pull an image from a registry
     runp          Run a new pod sandbox
     rm            Remove one or more containers
     rmi           Remove one or more images
     rmp           Remove one or more pod sandboxes
     pods          List pod sandboxes
     start         Start one or more created containers
     info          Display information of the container runtime
     stop          Stop one or more running containers
     stopp         Stop one or more running pod sandboxes
     update        Update one or more running containers
     config        Get and set crictl options
     stats         List container(s) resource usage statistics
     completion    Output bash shell completion code
     help, h       Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --config value, -c value            Location of the client config file (default: &quot;/etc/crictl.yaml&quot;) [$CRI_CONFIG_FILE]
   --debug, -D                         Enable debug mode
   --image-endpoint value, -i value    Endpoint of CRI image manager service [$IMAGE_SERVICE_ENDPOINT]
   --runtime-endpoint value, -r value  Endpoint of CRI container runtime service (default: &quot;unix:///var/run/dockershim.sock&quot;) [$CONTAINER_RUNTIME_ENDPOINT]
   --timeout value, -t value           Timeout of connecting to the server (default: 10s)
   --help, -h                          show help
   --version, -v                       print the version
</code></pre>
<p>&#x8AAA;&#x660E;&#x975E;&#x5E38;&#x7C21;&#x55AE;&#xFF0C;&#x5C31;&#x662F; <code>CRI</code> &#x547D;&#x4EE4;&#x5217;&#xFF0C;&#x5176;&#x9810;&#x8A2D;&#x7684;&#x8A2D;&#x5B9A;&#x6A94;&#x6848;&#x4F4D;&#x65BC; <code>/etc/crictl.yaml</code></p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~/cri/contrib/ansible$ cat /etc/crictl.yaml
runtime-endpoint: /run/containerd/containerd.sock
</code></pre>
<p>&#x6240;&#x4EE5;&#x63A5;&#x4E0B;&#x4F86;&#x547C;&#x53EB;&#x7684;&#x4EFB;&#x4F55; <code>crictl</code> &#x6307;&#x4EE4;&#x90FD;&#x6703;&#x8DDF; <code>containerd</code> &#x4E92;&#x52D5;&#x4F86;&#x53D6;&#x5F97;&#x56DE;&#x61C9;&#xFF0C;&#x6211;&#x5011;&#x5C31;&#x6839;&#x64DA;&#x4E0A;&#x9762;&#x7684;&#x63D0;&#x793A;&#x4F86;&#x8A66;&#x8A66;&#x770B;&#x5404;&#x7A2E;&#x6307;&#x4EE4;</p>
<p>&#x57FA;&#x65BC; <code>kubernetes POD</code> &#x6982;&#x5FF5;&#x7684;&#x8CC7;&#x6E90;&#x986F;&#x793A;</p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~/cri/contrib/ansible$ sudo crictl pods                                                                                                PODSANDBOX ID       CREATED             STATE               NAME                              NAMESPACE           ATTEMPT
4ed054a456e96       17 minutes ago      SANDBOX_READY       coredns-5c98db65d4-ghzpl          kube-system         0                                    c5209a01e0936       17 minutes ago      SANDBOX_READY       coredns-5c98db65d4-thsdq          kube-system         0
0a771e9912232       18 minutes ago      SANDBOX_READY       kube-flannel-ds-amd64-ztqgs       kube-system         0
0642c904298c8       18 minutes ago      SANDBOX_READY       kube-proxy-jfs66                  kube-system         0
46039553a0fcc       18 minutes ago      SANDBOX_READY       kube-scheduler-k8s-dev            kube-system         0
ec6d7cde198cc       18 minutes ago      SANDBOX_READY       kube-controller-manager-k8s-dev   kube-system         0
be0bc17da244d       18 minutes ago      SANDBOX_READY       etcd-k8s-dev                      kube-system         0
490d8b240d8ca       18 minutes ago      SANDBOX_READY       kube-apiserver-k8s-dev            kube-system         0
</code></pre>
<p>&#x76F8;&#x95DC;&#x7684; <code>container images</code>, &#x9019;&#x4E9B; <code>images</code> &#x518D;&#x4E4B;&#x524D;&#x90FD;&#x662F;&#x900F;&#x904E; <code>docker pull</code> &#x7B49;&#x65B9;&#x5F0F;&#x5B89;&#x88DD;&#xFF0C;&#x5982;&#x4ECA;&#x6211;&#x5011;&#x7CFB;&#x7D71;&#x5167;&#x5B8C;&#x5168;&#x4E0D;&#x88DD; <code>docker</code> &#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x9019;&#x4E00;&#x5207;&#x90FD;&#x662F;&#x4EF0;&#x8CF4; <code>OCI</code> &#x6A19;&#x6E96;&#x7684;&#x5236;&#x5B9A;&#x5916;&#x52A0; <code>containerd</code> &#x7684;&#x5E6B;&#x5FD9;&#x3002;</p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~/cri/contrib/ansible$ sudo crictl images
IMAGE                                TAG                 IMAGE ID            SIZE
k8s.gcr.io/coredns                   1.3.1               eb516548c180f       12.3MB
k8s.gcr.io/etcd                      3.3.10              2c4adeb21b4ff       76.2MB
k8s.gcr.io/kube-apiserver            v1.15.3             5eb2d3fc7a44e       49.3MB
k8s.gcr.io/kube-controller-manager   v1.15.3             e77c31de55475       47.8MB
k8s.gcr.io/kube-proxy                v1.15.3             232b5c7931462       30.1MB
k8s.gcr.io/kube-scheduler            v1.15.3             703f9c69a5d57       29.9MB
k8s.gcr.io/pause                     3.1                 da86e6ba6ca19       317kB
quay.io/coreos/flannel               v0.11.0-amd64       8a9c4ced3ff92       16.9MB
vagrant@k8s-dev:~/cri/contrib/ansible$ sudo crictl ps
</code></pre>
<p>&#x63A5;&#x4E0B;&#x4F86;&#x770B;&#x770B;&#x904B;&#x884C;&#x7684; <code>container</code>, &#x5176;&#x7D50;&#x679C;&#x8DDF; <code>docker ps</code> &#x975E;&#x5E38;&#x76F8;&#x4F3C;&#xFF0C;&#x4F7F;&#x7528;&#x8D77;&#x4F86;&#x5E7E;&#x4E4E;&#x6C92;&#x6709;&#x4EFB;&#x4F55;&#x9055;&#x548C;&#x611F;&#xFF0C;&#x6211;&#x89BA;&#x5F97;&#x8A2D;&#x5B9A; <code>alias docker=crictl</code> &#x90FD;&#x4E0D;&#x6703;&#x6709;&#x4EC0;&#x9EBC;&#x932F;&#x89BA;?</p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~/cri/contrib/ansible$ sudo crictl ps
CONTAINER ID        IMAGE                                                                     CREATED             STATE               NAME
         ATTEMPT
1cf00f473d03a       sha256:eb516548c180f8a6e0235034ccee2428027896af16a509786da13022fe95fe8c   19 minutes ago      CONTAINER_RUNNING   coredns
         0
221b815ca1f56       sha256:eb516548c180f8a6e0235034ccee2428027896af16a509786da13022fe95fe8c   19 minutes ago      CONTAINER_RUNNING   coredns
         0
f35552b98abc1       sha256:8a9c4ced3ff92c63c446d55c2353c42410c78b497a0483d4048e8d30ebe37058   19 minutes ago      CONTAINER_RUNNING   kube-flannel
         0
8eafd7980b1d3       sha256:232b5c79314628fbc788319e2dff191f4d08e38962e42ebd31b55b52fecd70ec   19 minutes ago      CONTAINER_RUNNING   kube-proxy
         0
feb2ed1caa423       sha256:2c4adeb21b4ff8ed3309d0e42b6b4ae39872399f7b37e0856e673b13c4aba13d   20 minutes ago      CONTAINER_RUNNING   etcd
         0
00be90f2a7ac0       sha256:703f9c69a5d578378a022dc75d0c242d599422a1b7cc9cf5279b49d39dc7ca08   20 minutes ago      CONTAINER_RUNNING   kube-scheduler
         0
e16c5a24ff09d       sha256:e77c31de554758f3f03e78e124a914b7d86de7d7cf3d677c9b720efb90a833f9   20 minutes ago      CONTAINER_RUNNING   kube-controller-m
anager   0
fbe374eb60712       sha256:5eb2d3fc7a44e3a8399256d4b60153a1a59165e70334a1c290fcbd33a9a9d8a7   20 minutes ago      CONTAINER_RUNNING   kube-apiserver
         0
</code></pre>
<p>&#x9664;&#x4E86; <code>container</code> &#x672C;&#x8EAB;&#x7684;&#x7BA1;&#x7406;&#x5916;&#xFF0C;&#x6211;&#x5011;&#x4F86;&#x770B;&#x4E00;&#x4E0B;&#x7CFB;&#x7D71;&#x5167;&#x904B;&#x884C;&#x7684;&#x61C9;&#x7528;&#x7A0B;&#x5F0F;, &#x53EF;&#x4EE5;&#x89C0;&#x5BDF;&#x5230;&#x7CFB;&#x7D71;&#x4E0A;&#x6709;&#x4E00;&#x500B; <code>containerd</code> &#x6B63;&#x5728;&#x904B;&#x884C;&#xFF0C;&#x540C;&#x6642; <code>kuberlet</code> &#x5167;&#x95DC;&#x65BC; <code>container-runtime</code> &#x7684;&#x53C3;&#x6578;&#x6709;&#x88AB;&#x4FEE;&#x6539;&#x3002;</p>
<p>&#x6B64;&#x5916;&#x5C0D;&#x65BC;&#x6BCF;&#x500B;&#x904B;&#x4F5C;&#x7684; <code>container</code>, <code>containetd</code> &#x90FD;&#x6703;&#x7522;&#x751F;&#x4E00;&#x500B; <code>containerd-shim</code> &#x4F86;&#x904B;&#x4F5C;&#x3002;</p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~/cri/contrib/ansible$ ps -axo command | grep containerd
/usr/local/bin/containerd

/usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/conf
ig.yaml --container-runtime=remote --container-runtime-endpoint=/run/containerd/containerd.sock --runtime-cgroups=/system.slice/containerd.service --co
ntainer-runtime=remote --runtime-request-timeout=15m --container-runtime-endpoint=unix:///run/containerd/containerd.sock

containerd-shim -namespace k8s.io -workdir /var/lib/containerd/io.containerd.runtime.v1.linux/k8s.io/490d8b240d8ca4c0df7d8440c5002ca795bddb989fb8bc6de2
0da78394eb8ce6 -address /run/containerd/containerd.sock -containerd-binary /usr/local/bin/containerd
...
.....
</code></pre>
<h2 id="docker">Docker</h2>
<p>&#x70BA;&#x4E86;&#x9A57;&#x8B49;&#x4E4B;&#x524D;&#x8AAA;&#x660E;&#x662F;&#x5426; <code>dockerd</code> &#x8207; <code>kubelet</code> &#x5171;&#x7528; <code>containerd</code> &#x4F46;&#x662F;&#x5F7C;&#x6B64;&#x8CC7;&#x6E90;&#x662F;&#x4E92;&#x76F8;&#x9694;&#x96E2;&#x7684;&#xFF0C;&#x9019;&#x6642;&#x5019;&#x6211;&#x5011;&#x4F86;&#x5B89;&#x88DD;&#x4E00;&#x4E0B; <code>docker</code> &#x4E26;&#x4E14;&#x65BC;&#x80CC;&#x666F;&#x904B;&#x884C;&#x4E00;&#x500B; <code>container</code> &#x8A66;&#x8A66;&#x770B;</p>
<pre><code class="lang-bash=">sudo docker run -d hwchiu/netutils
</code></pre>
<p>&#x63A5;&#x4E0B;&#x4F86;&#x6211;&#x5011;&#x4F7F;&#x7528; <code>docker</code> &#x6307;&#x4EE4;&#x91DD;&#x5C0D;&#x4E0A;&#x8FF0;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x9032;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x4F86;&#x6BD4;&#x8F03;&#x770B;&#x770B;</p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~$ sudo docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hwchiu/netutils     latest              a0d1dad34d58        13 months ago       222MB
vagrant@k8s-dev:~$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
320b653e39d8        hwchiu/netutils     &quot;/bin/bash ./entrypo&#x2026;&quot;   15 minutes ago      Up 15 minutes                           inspiring_haslett
</code></pre>
<p>&#x975E;&#x5E38;&#x4E7E;&#x6DE8;&#x7C21;&#x55AE;&#xFF0C;&#x5B8C;&#x5168;&#x770B;&#x4E0D;&#x5230;&#x4EFB;&#x4F55; <code>kubernetes</code> &#x7528;&#x5230;&#x7684;&#x5BB9;&#x5668;&#x8CC7;&#x6E90;&#xFF0C;&#x6B64;&#x5916;&#x6211;&#x5011;&#x518D;&#x5EA6;&#x900F;&#x904E; &#xFF40;<code>ps</code> &#x89C0;&#x5BDF;</p>
<pre><code class="lang-bash=">/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock

containerd-shim -namespace moby -workdir /var/lib/containerd/io.containerd.runtime.v1.linux/moby/320b653e39d8164e3033f1eec079c7772a10e703d24bb7f39f7bdf26fe084fe5 -address /run/containerd/containerd.sock -containerd-binary /usr/local/bin/containerd -runtime-root /var/run/docker/runtime-runc
</code></pre>
<p>&#x9996;&#x5148;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>dockerd</code> &#x9019;&#x6642;&#x5019;&#x4E5F;&#x900F;&#x904E;&#x53C3;&#x6578;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x9023;&#x63A5; <code>containerd</code>, &#x53E6;&#x5916;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x91DD;&#x5C0D;&#x6211;&#x4E0A;&#x8FF0;&#x7684; <code>docker image</code> &#x6240;&#x7522;&#x751F;&#x7684; <code>containerd-shim</code> &#x8207; <code>kubernetes</code> &#x7522;&#x751F;&#x7684; <code>containerd-shim</code> &#x6709;&#x660E;&#x986F;&#x7684;&#x53C3;&#x6578;&#x4E0D;&#x540C;</p>
<ol>
<li>-namespace moby v.s k8s.io</li>
<li>workdir &#x4E0D;&#x540C;</li>
<li>-runtime-root /var/run/docker/runtime-runc</li>
</ol>
<p>&#x6B64;&#x5916;&#x6211;&#x5011;&#x4E5F;&#x53EF;&#x4EE5;&#x900F;&#x904E; <code>containerd cli(ctr) and containerd</code> &#x4F86;&#x89C0;&#x5BDF;&#x66F4;&#x591A;&#x6709;&#x8DA3;&#x7684;&#x8CC7;&#x8A0A;</p>
<p>&#x9996;&#x5148;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5C0D;&#x65BC; <code>containerd</code> &#x7684;&#x78BA;&#x6709;&#x4E0D;&#x540C;&#x7684; <code>namespace</code>&#xFF0C;&#x4E5F;&#x7684;&#x78BA;&#x5982;&#x4E0A;&#x9762;&#x6240;&#x89C0;&#x5BDF;&#x5230;&#x7684;&#x662F; <code>moby</code> &#x8207; <code>k8s.io</code></p>
<pre><code class="lang-bash=">vagrant@k8s-dev:~$ sudo ctr namespaces ls
NAME   LABELS
k8s.io
moby
</code></pre>
<p>&#x6B64;&#x5916;&#x6211;&#x5011;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0D;&#x5C11;&#x95DC;&#x65BC; containerd &#x9810;&#x8A2D;&#x7684;&#x8A2D;&#x5B9A;&#xFF0C;&#x9810;&#x8A2D;&#x60C5;&#x6CC1;&#x4E0B; <code>linux</code> &#x74B0;&#x5883;&#x4E2D;&#x90FD;&#x662F;&#x63A1;&#x7528; <code>runc</code> &#x4F5C;&#x70BA; <code>OCI Runtime Spec</code> &#x7684;&#x89E3;&#x6C7A;&#x65B9;&#x6848;&#x3002;
&#x800C; <code>kubelet</code> &#x900F;&#x904E; <code>CRI</code> &#x8207; <code>docker</code> &#x6700;&#x5F8C;&#x9078;&#x64C7;&#x90FD;&#x662F;&#x6703;&#x63A1;&#x53D6; <code>plugin.linux</code> &#x7684;&#x8A2D;&#x5B9A;&#xFF0C;&#x6240;&#x4EE5;&#x5169;&#x8005;&#x80CC;&#x5F8C;&#x6700;&#x5F8C;&#x90FD;&#x662F;&#x900F;&#x904E; <code>runc</code> &#x4F86;&#x5275;&#x5EFA; <code>Container</code>&#x3002;</p>
<pre><code class="lang-bash=">sudo containerd config default
...
  [plugins.cri]
    stream_server_address = &quot;&quot;
    stream_server_port = &quot;10010&quot;
    enable_selinux = false
    sandbox_image = &quot;k8s.gcr.io/pause:3.1&quot;
    stats_collect_period = 10
    systemd_cgroup = false
    [plugins.cri.containerd]
      snapshotter = &quot;overlayfs&quot;
      [plugins.cri.containerd.default_runtime]
        runtime_type = &quot;io.containerd.runtime.v1.linux&quot;
        runtime_engine = &quot;&quot;
        runtime_root = &quot;&quot;
      [plugins.cri.containerd.untrusted_workload_runtime]
        runtime_type = &quot;&quot;
        runtime_engine = &quot;&quot;
        runtime_root = &quot;&quot;
...
  [plugins.linux]
    shim = &quot;containerd-shim&quot;
    runtime = &quot;runc&quot;
    runtime_root = &quot;&quot;
    no_shim = false
    shim_debug = false
...
</code></pre>
<h1 id="summary">Summary</h1>
<p>&#x672C;&#x6587;&#x4E2D;&#x6211;&#x5011;&#x7C21;&#x8FF0;&#x4E86;&#x5982;&#x4F55;&#x5EFA;&#x7F6E;&#x4E00;&#x5957;&#x57FA;&#x65BC; <code>containerd</code> &#x800C;&#x975E; <code>docker</code> &#x7684; <code>kubernetes cluster</code>, &#x4E26;&#x4E14;&#x900F;&#x904E;&#x76F8;&#x95DC;&#x6307;&#x4EE4;&#x8207;&#x5DE5;&#x5177;&#x4F86;&#x89C0;&#x5BDF;&#x5728;&#x6B64;&#x8A2D;&#x5B9A;&#x4E0B;&#xFF0C;<code>kubernetes</code>,<code>containerd</code>, <code>dockerd</code> &#x7B49;&#x5F7C;&#x6B64;&#x7684;&#x4EA4;&#x4E92;&#x95DC;&#x4FC2;&#xFF0C;&#x53EF;&#x4EE5;&#x66F4;&#x52A0;&#x6DF1;&#x5C0D;&#x65BC; <code>CRI, OCI</code> &#x7B49;&#x6982;&#x5FF5;&#x7684;&#x7406;&#x89E3;&#x3002;</p>
<p>kubelet -&gt; containerd -&gt; containetrd-shin(k8s.io) -&gt; runc</p>
<p>docker client -&gt; docker enginer -&gt; containerd -&gt; containerd-shim(moby) -&gt; runc </p>
<h1 id="&#x53C3;&#x8003;">&#x53C3;&#x8003;</h1>
<ul>
<li><a href="https://github.com/containerd/cri/tree/master/contrib/ansible" target="_blank">https://github.com/containerd/cri/tree/master/contrib/ansible</a></li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-runtime" target="_blank">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-runtime</a> </li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/kubelet-integration/#the-kubelet-drop-in-file-for-systemd" target="_blank">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/kubelet-integration/#the-kubelet-drop-in-file-for-systemd</a></li>
<li><a href="https://gist.github.com/mcastelino/35c221a81c70afc12f8b0929774b60a3" target="_blank">https://gist.github.com/mcastelino/35c221a81c70afc12f8b0929774b60a3</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="day5.html" class="navigation navigation-prev " aria-label="Previous page: Kubernetes & CRI (I)">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="day7.html" class="navigation navigation-next " aria-label="Next page: Container Runtime - CRI-O">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Kubernetes & CRI (II)","level":"1.2.3.2","depth":3,"next":{"title":"Container Runtime - CRI-O","level":"1.2.3.3","depth":3,"path":"2019/runtime/day7.md","ref":"2019/runtime/day7.md","articles":[]},"previous":{"title":"Kubernetes & CRI (I)","level":"1.2.3.1","depth":3,"path":"2019/runtime/day5.md","ref":"2019/runtime/day5.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"2019/runtime/day6.md","mtime":"2021-12-14T03:18:27.661Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-12-14T03:20:41.769Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

